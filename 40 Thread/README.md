# 40 Thread

# 프로그램과 프로세스

![Untitled](40%20Thread%20b828237ec05b48389024e21834287103/Untitled.png)

- 프로그램
    
    실행할 수 있는, 저장장치에 저장된 운영체제 및 응용 프로그램 등을 말한다.
    
- 프로세스
    
    프로그램의 실행 단위. 프로그램이 메모리에 올라오면 프로세스가 된다.
    

## 프로세스의 특징

![Untitled](40%20Thread%20b828237ec05b48389024e21834287103/Untitled%201.png)

프로그램이 메모리에 올라가 프로세스가 되면 코드와 데이터(텍스트, 데이터, 힙, 스택의 메모리 영역)을 할당받는다. 하나의 프로세스는 모두 위와 같은 메모리 공간을 할당받는다.

이때 하나의 프로그램은 여러 프로세스를 가질 수 있다. 멀티 프로세스는 여러 프로그램을 작은 단위로 쪼개어 메모리에 올리고, 각 프로세스들이 교대로 프로세서를 공유하는 방식으로 이루어지기에 필연적으로 여러 프로세스를 가지게 된다. 이 때 텍스트, 데이터, 힙 등 프로그램 실행 시 한 번만 읽어오면 되거나 프로그램 단위가 공유하는 메모리 영역이 공간에 중복되기에 자원이 낭비되는 문제가 있다.

이런 자원은 한 번만 메모리에 올리고 다른 실행 단위에 공유하는 것이 경제적이므로 공유 자원 개념이 등장하게 된다.

# 스레드

![Untitled](40%20Thread%20b828237ec05b48389024e21834287103/Untitled%202.png)

- 공유가능
    
    완전히 독립적인 프로세스와 달리 스레드는 코드, 데이터, 힙 영역을 동유하며, 하나의 스레드는 스택 영역만을 할당받는다.
    
- [병렬처리](https://velog.io/@younghoondoodoom/%EB%A9%80%ED%8B%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4Multi-Process%EC%99%80-%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9CMulti-Thread)
    - 멀티 프로세스
        
        여러 CPU를 사용해 여러 프로세스를 동시에 수행하는 것
        
    - 멀티 스레드
        
        여러 스레드를 동시에 실행하는 것
        
        하나의 프로세스가 여러 스레드를 가질 수 있다.
        
        프로세스의 자원을 공유하며 서로 통신할 수 있다.
        
        단 전역 변수 및 동적 할당된 메모리에 접근할 경우, 다른 스레드가 동시에 접근할 수 있으므로 주의한다.
        
    - [동기화](https://velog.io/@backtony/Java-synchronized-%EB%8F%99%EA%B8%B0%ED%99%94)
        
        **`public synchronized void method(){}`**
        
        **`public void exampleMethod(){ synchronized(obj){} }`**
        
        스레드 간 동기화가 보장되지 않으면 여러 스레드가 데이터에 접근해 상태를 수정할 수 있고, 특정 시점에 해당 데이터의 안정성과 신뢰성을 보장할 수 없게 된다(예: 실시간 경매).
        
        데이터의 thread-safe를 보장하기 위해서는 스레드 간 동기화를 보장해야 하는데, 자바에서는 **`synchronized`** 키워드를 사용할 수 있다.
        
        해당 키워드를 사용하면 현재 데이터를 사용하고 있는 스레드를 제외한 스레드는 해당 데이터에 접근할 수 없다.
        
        몇몇 JCF(Java Collection Framework, 콜렉션 API)에서는 기본적으로 thread-safe를 보장한다.
        

# 자바의 스레드

## extends Thread

Runnable 인터페이스를 구현한 클래스이다.

run 메서드를 사용한다.

## implements Runnable

준스레드

스레드의 모든 기능을 사용하기 위해서는 추가적인 작업이 필요하다.

run 메서드를 오버라이딩해야 한다.

## 우선권

### 우선 순위

자바에는 1부터 10까지의 우선 순위가 있다. 스레드의 우선 순위는 5(default)이다.

우선 순위가 높을 수록 실행 상태를 더 많이 가질 수 있다.

같은 우선 순위인 경우 먼저 생성된 스레드가 우선 순위를 가진다.

해당 우선 순위는 사용자가 수정할 수 있다.

### 순환 할당 방식(라운드 로빈)

시간 할당량을 정해 하나의 스레드를 정해진 시간만큼 실행하고 다시 다른 스레드를 실행하는 방식

JVM에 의해 정해지기 때문에 사용자가 수정할 수 없다.

# 자바에서 스레드의 상태

자바에서는 메인 함수도 스레드로 관리된다.

![Untitled](40%20Thread%20b828237ec05b48389024e21834287103/Untitled%203.png)

1. 시작
    
    start()
    
    스레드가 준비단계로 넘어간다.
    
2. 준비(wait pool)
    
    스케쥴러가 우선권에 의해 시행할 스레드를 선택한다.
    
3. 실행
    
    스케쥴러에 의해 선택된 스레드의 run()메서드가 호출된다.
    
4. 제거
    
    run()메서드 내부 문장을 모두 실행
    
5. 블럭
    
    Sleep(), yeild(), join()
    
    실행 중에 대기 상태로 전환됨
    
    - 우선권이 높은 스레드가 준비 단계에 들어섬
        
        → synchronized 키워드로 현재 데이터를 사용하고 있는 스레드를 제외하고 다른 스레드가 해당 데이터에 접근할 수 없도록 막을 수 있다.
        

## 동기화